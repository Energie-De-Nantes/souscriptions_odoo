# Makefile simplifiÃ© pour le module Odoo souscriptions
# Suit les recommandations Python unittest et commandes Odoo officielles

# Variables
PYTHON = python3
ODOO = odoo
DB_NAME ?= souscriptions_test
MODULE_NAME = souscriptions

.PHONY: help test install update clean

# Aide par dÃ©faut
help:
	@echo "ğŸš€ Module Odoo souscriptions - Commandes essentielles"
	@echo ""
	@echo "Tests (recommandÃ©: utiliser test_runner.py):"
	@echo "  test              Tests avec test_runner.py (recommandÃ©)"
	@echo "  test-odoo         Tests avec commande Odoo directe"
	@echo "  test-unittest     Tests avec unittest discovery"
	@echo ""
	@echo "DÃ©veloppement:"
	@echo "  install           Installer le module"
	@echo "  update            Mettre Ã  jour le module"
	@echo "  demo              Mode dÃ©mo"
	@echo "  shell             Shell Odoo"
	@echo ""
	@echo "Maintenance:"
	@echo "  clean             Nettoyer"
	@echo ""
	@echo "ğŸ“˜ Utilisation recommandÃ©e:"
	@echo "  $(PYTHON) test_runner.py --help"
	@echo "  $(PYTHON) test_runner.py basic"
	@echo "  $(PYTHON) test_runner.py template --verbose"

# Tests - MÃ©thode recommandÃ©e avec test_runner.py
test:
	@echo "ğŸ§ª Tests avec test_runner.py (mÃ©thode recommandÃ©e)"
	$(PYTHON) test_runner.py all --install

# Tests - Commande Odoo directe (backup)
test-odoo:
	@echo "ğŸ§ª Tests avec commande Odoo directe"
	$(ODOO) -d $(DB_NAME) --test-enable --test-tags souscriptions --stop-after-init -i $(MODULE_NAME)

# Tests - Unittest discovery (exploration)
test-unittest:
	@echo "ğŸ” DÃ©couverte des tests avec unittest"
	$(PYTHON) -m unittest discover -s tests -p "test_*.py" -v

# DÃ©veloppement
install:
	$(ODOO) -d $(DB_NAME) -i $(MODULE_NAME) --stop-after-init

update:
	$(ODOO) -d $(DB_NAME) -u $(MODULE_NAME) --stop-after-init

demo:
	$(ODOO) -d $(DB_NAME) --dev=reload,qweb,werkzeug,xml

shell:
	$(ODOO) shell -d $(DB_NAME)

# Maintenance
clean:
	find . -name "*.pyc" -delete
	find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	rm -f /tmp/facture_*.html

# Validation avant commit
pre-commit: clean test
	@echo "âœ… Validation rÃ©ussie!"