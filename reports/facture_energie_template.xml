<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template personnalisé pour les factures d'énergie en héritage simple -->
    <template id="report_facture_energie_document" inherit_id="account.report_invoice_document">
        
        <!-- Remplacement du titre pour les factures d'énergie -->
        <xpath expr="//h2" position="replace">
            <h2 class="mt-4" t-if="o.is_facture_energie" style="color: #2E7D32;">
                <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Facture d'Électricité</span>
                <span t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Projet de Facture d'Électricité</span>
                <span t-elif="o.move_type == 'out_refund'">Avoir d'Électricité</span>
                <span t-else="">Document</span>
                <span t-field="o.name"/>
            </h2>
            <h2 class="mt-4" t-else="">
                <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Facture</span>
                <span t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Projet de facture</span>
                <span t-elif="o.move_type == 'out_refund'">Avoir</span>
                <span t-else="">Document</span>
                <span t-field="o.name"/>
            </h2>
        </xpath>

        <!-- Ajout des informations spécifiques à l'énergie après les dates -->
        <xpath expr="//div[@name='due_date']" position="after">
            <div class="row mt-3" t-if="o.is_facture_energie and o.souscription_id">
                <div class="col-12">
                    <div style="background-color: #E8F5E8; padding: 15px; border-radius: 5px; border-left: 4px solid #2E7D32;">
                        <h5 style="color: #2E7D32; margin-bottom: 10px;">
                            ⚡ Informations Souscription Électricité
                        </h5>
                        <div class="row">
                            <div class="col-6">
                                <strong>Référence:</strong> <span t-field="o.souscription_id.name"/><br/>
                                <strong>PDL:</strong> <span t-field="o.souscription_id.pdl"/><br/>
                                <strong>Puissance:</strong> <span t-field="o.souscription_id.puissance_souscrite"/> kVA
                            </div>
                            <div class="col-6">
                                <strong>Type de tarif:</strong> <span t-field="o.souscription_id.type_tarif"/><br/>
                                <strong>Période:</strong> <span t-field="o.periode_id.mois_annee"/><br/>
                                <strong>Compteur:</strong> <span t-field="o.souscription_id.ref_compteur"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>

        <!-- Modification du style des en-têtes de colonnes pour l'énergie -->
        <xpath expr="//th[@name='th_description']" position="attributes">
            <attribute name="t-attf-style">#{o.is_facture_energie and 'color: #2E7D32;' or ''}</attribute>
        </xpath>

        <!-- Ajout du footer spécifique énergie -->
        <xpath expr="//div[@name='comment']" position="after">
            <div t-if="o.is_facture_energie" class="mt-3" style="border-top: 1px solid #2E7D32; padding-top: 10px;">
                <div class="row">
                    <div class="col-12 text-center">
                        <small style="color: #2E7D32;">
                            <strong>Information réglementaire :</strong> 
                            Les montants TURPE correspondent aux coûts d'acheminement de l'électricité 
                            et sont indiqués à titre informatif.
                        </small>
                    </div>
                </div>
            </div>
        </xpath>

    </template>

    <!-- Rapport utilisant le template personnalisé -->
    <record id="action_report_facture_energie" model="ir.actions.report">
        <field name="name">Facture d'Électricité</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">souscriptions.report_facture_energie_document</field>
        <field name="report_file">souscriptions.report_facture_energie_document</field>
        <field name="print_report_name">'Facture_Energie_%s_%s' % (object.souscription_id.name or '', object.name)</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_type">report</field>
    </record>

</odoo>