<odoo>
    <record id="view_souscription_form" model="ir.ui.view">
        <field name="name">souscription.form</field>
        <field name="model">souscription.souscription</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Souscription">
                <header>
                    <button name="%(action_souscription_contrat_report)d" 
                            string="Imprimer contrat" 
                            type="action" 
                            class="btn-primary"/>
                </header>
                <sheet>
                    <group>
                        <field name="name" />
                        <field name="partner_id" />
                        <field name="active" />
                        <field name="etat_facturation_id"/>
                        <field name="date_debut"/>
                        <field name="date_fin"/>
                    </group>
                    <group string="Caractéristiques facturantes">
                        <field name="pdl"/>
                        <field name="puissance_souscrite"/>
                        <field name="lisse"/>
                        <field name="provision_mensuelle_kwh" invisible="not lisse"/>
                        <field name="type_tarif"/>
                        <field name="tarif_solidaire"/>
                    </group>
                    <group string="Paiement">
                        <field name="mode_paiement"/>
                        <field name="coeff_pro" string="Majoration PRO (%)"/>
                    </group>
                    
                    <group string="Infos">
                        <field name="ref_compteur"/>
                        <field name="numero_depannage" widget="phone"/>
                    </group>
                    
                    <notebook>
                        <page string="Périodes de facturation">
                            <field name="periode_ids">
                                <list editable="bottom">
                                    <field name="mois_annee"/>
                                    <field name="type_periode"/>
                                    <field name="type_tarif_periode"/>
                                    <field name="energie_base_kwh" invisible="type_tarif_periode != 'Base'"/>
                                    <field name="provision_base_kwh" invisible="type_tarif_periode != 'Base'"/>
                                    <field name="energie_hp_kwh" invisible="type_tarif_periode == 'Base'"/>
                                    <field name="provision_hp_kwh" invisible="type_tarif_periode == 'Base'"/>
                                    <field name="energie_hc_kwh" invisible="type_tarif_periode == 'Base'"/>
                                    <field name="provision_hc_kwh" invisible="type_tarif_periode == 'Base'"/>
                                    <field name="jours"/>
                                    <field name="turpe_fixe"/>
                                    <field name="turpe_variable"/>
                                    <field name="facture_id"/>
                                </list>
                            </field>
                        </page>
                        <!-- Onglets métier supprimés pour version minimale -->
                        <!-- Historique et Prestations disponibles via module souscriptions_bridge -->
                    </notebook>
                </sheet>
                <chatter open_attachments="True"/>
            </form>
        </field>
    </record>
    <record id="view_souscription_list" model="ir.ui.view">
        <field name="name">souscription.list</field>
        <field name="model">souscription.souscription</field>
        <field name="arch" type="xml">
          <list string="Souscriptions">
            <field name="name"/>
            <field name="partner_id"/>
            <field name="lisse"/>
            <field name="active"/>
          </list>
        </field>
    </record>

    <!-- Action serveur (pour déclencher la méthode Python) -->
    <record id="action_creer_factures" model="ir.actions.server">
        <field name="name">Créer factures</field>
        <field name="model_id" ref="model_souscription_souscription"/>
        <field name="binding_model_id" ref="model_souscription_souscription"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            records.creer_factures()
        </field>
    </record>
    <record id="action_ajouter_periodes_mensuelles" model="ir.actions.server">
        <field name="name">Créer les périodes du mois précédent</field>
        <field name="model_id" ref="model_souscription_souscription"/>
        <field name="binding_model_id" ref="model_souscription_souscription"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            records.ajouter_periodes_mensuelles()
        </field>
    </record>
    <record id="action_generer_lot_prelevement" model="ir.actions.server">
        <field name="name">Générer lot prélèvement</field>
        <field name="model_id" ref="model_souscription_souscription"/>
        <field name="binding_model_id" ref="model_souscription_souscription"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">env['souscription.souscription'].generer_lot_prelevement_mensuel()</field>
    </record>
    <record id="view_souscription_kanban" model="ir.ui.view">
        <field name="name">souscription.kanban</field>
        <field name="model">souscription.souscription</field>
        <field name="type">kanban</field>
        <field name="arch" type="xml">
            <kanban default_group_by="etat_facturation_id">
                <field name="etat_facturation_id"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click">
                            <strong><field name="name"/></strong><br/>
                            <span><field name="etat_facturation_id"/></span>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_souscription" model="ir.actions.act_window">
        <field name="name">Souscriptions</field>
        <field name="res_model">souscription.souscription</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'list', 'view_id': ref('view_souscription_list')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_souscription_form')}),
        ]"/>
    </record>

    <menuitem
        id="menu_souscription_root"
        name="Souscriptions"
        action="action_souscription"
        sequence="10" />
</odoo>